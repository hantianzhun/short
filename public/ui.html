<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Áü≠ÈìæÁÆ°ÁêÜ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --bg: #f5f7fb;
      --card: #ffffff;
      --border: #e5e7eb;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: var(--bg);
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.05);
      margin-bottom: 20px;
    }

    h1 {
      margin: 0 0 20px;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 10px;
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 8px;
    }

    button:hover {
      opacity: 0.9;
    }

    button[type="button"] {
      background: #6b7280;
    }

    button[type="button"]:hover {
      background: #4b5563;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    a {
      color: var(--primary);
      text-decoration: none;
    }

    /* Ëá™ÂÆö‰πâÂØπËØùÊ°ÜÊ†∑Âºè */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      animation: fadeIn 0.2s ease-in-out forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .modal {
      background: var(--card);
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      transform: scale(0.9);
      animation: slideUp 0.2s ease-out forwards;
    }

    @keyframes slideUp {
      to {
        transform: scale(1);
      }
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }

    .modal-message {
      color: #666;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .modal-btn-primary {
      background: var(--primary);
      color: white;
    }

    .modal-btn-primary:hover {
      opacity: 0.9;
    }

    .modal-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-btn-secondary:hover {
      background: #e5e7eb;
    }

    .modal-btn-danger {
      background: #ef4444;
      color: white;
    }

    .modal-btn-danger:hover {
      background: #dc2626;
    }

    /* ÊèêÁ§∫Ê°ÜÊ†∑Âºè */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 300px;
      opacity: 0;
      transform: translateX(400px);
      animation: slideInRight 0.3s ease-out forwards;
    }

    @keyframes slideInRight {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast-error {
      border-left: 4px solid #ef4444;
    }

    .toast-success {
      border-left: 4px solid #10b981;
    }

    .toast-icon {
      font-size: 20px;
    }

    /* ÁßªÂä®Á´ØÈÄÇÈÖç */
    @media (max-width: 768px) {
      .container {
        margin: 20px auto;
        padding: 15px;
      }

      .card {
        padding: 15px;
        margin-bottom: 15px;
      }

      h1 {
        font-size: 24px;
        margin: 0 0 15px;
      }

      input {
        padding: 12px;
        font-size: 16px; /* Èò≤Ê≠¢ iOS Ëá™Âä®Áº©Êîæ */
        margin-bottom: 12px;
      }

      button {
        padding: 12px 20px;
        font-size: 16px;
        width: 100%;
        margin-top: 8px;
      }

      /* Ë°®Ê†ºÂú®ÁßªÂä®Á´ØÊîπ‰∏∫Âç°ÁâáÂºèÂ∏ÉÂ±Ä */
      table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      thead {
        display: none;
      }

      tbody {
        display: block;
      }

      tr {
        display: block;
        margin-bottom: 15px;
        background: var(--card);
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,.05);
      }

      td {
        display: block;
        padding: 8px 0;
        border-bottom: none;
        text-align: left;
      }

      td:before {
        content: attr(data-label) ": ";
        font-weight: bold;
        color: #666;
        display: inline-block;
        min-width: 80px;
      }

      td:last-child {
        padding-top: 12px;
        border-top: 1px solid var(--border);
        margin-top: 8px;
      }

      td:last-child:before {
        display: none;
      }

      td:last-child button {
        width: 100%;
        margin-top: 0;
        margin-bottom: 8px;
      }

      td:last-child button:last-child {
        margin-bottom: 0;
      }
    }

    /* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }

      .card {
        padding: 12px;
      }

      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üîó Áü≠ÈìæÁÆ°ÁêÜ</h1>

    <div class="card">
      <form id="createForm">
        <input name="code" placeholder="Áü≠Á†Å" required />
        <input name="url" placeholder="ÁõÆÊ†á URL" required />
        <button type="submit">ÂàõÂª∫Áü≠Èìæ</button>
      </form>
    </div>

    <div class="card" id="updateCard" style="display: none;">
      <h3>Êõ¥Êñ∞Áü≠Èìæ</h3>
      <form id="updateForm">
        <input type="hidden" name="code" id="updateCode" />
        <input name="url" id="updateUrl" placeholder="Êñ∞ÁõÆÊ†á URL" required />
        <button type="submit">Êõ¥Êñ∞</button>
        <button type="button" onclick="cancelUpdate()">ÂèñÊ∂à</button>
      </form>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th>Áü≠Á†Å</th>
            <th>ÁõÆÊ†áÂú∞ÂùÄ</th>
            <th>Êìç‰Ωú</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>
  </div>

  <script>
    const listEl = document.getElementById('list')

    // Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂØπËØùÊ°Ü
    function showConfirm(message, onConfirm, onCancel) {
      const overlay = document.createElement('div')
      overlay.className = 'modal-overlay'
      
      const modal = document.createElement('div')
      modal.className = 'modal'
      
      const title = document.createElement('div')
      title.className = 'modal-title'
      title.textContent = 'Á°ÆËÆ§Êìç‰Ωú'
      
      const messageDiv = document.createElement('div')
      messageDiv.className = 'modal-message'
      messageDiv.innerHTML = message
      
      const actions = document.createElement('div')
      actions.className = 'modal-actions'
      
      const cancelBtn = document.createElement('button')
      cancelBtn.className = 'modal-btn modal-btn-secondary'
      cancelBtn.setAttribute('data-action', 'cancel')
      cancelBtn.textContent = 'ÂèñÊ∂à'
      
      const confirmBtn = document.createElement('button')
      confirmBtn.className = 'modal-btn modal-btn-danger'
      confirmBtn.setAttribute('data-action', 'confirm')
      confirmBtn.textContent = 'Á°ÆËÆ§'
      
      actions.appendChild(cancelBtn)
      actions.appendChild(confirmBtn)
      modal.appendChild(title)
      modal.appendChild(messageDiv)
      modal.appendChild(actions)
      overlay.appendChild(modal)
      document.body.appendChild(overlay)

      const handleClick = (e) => {
        const action = e.target.getAttribute('data-action')
        if (action === 'confirm') {
          overlay.remove()
          if (onConfirm) onConfirm()
        } else if (action === 'cancel' || e.target === overlay) {
          overlay.remove()
          if (onCancel) onCancel()
        }
      }

      overlay.addEventListener('click', handleClick)
    }

    // Ëá™ÂÆö‰πâÊèêÁ§∫Ê°Ü
    function showToast(message, type = 'error') {
      const toast = document.createElement('div')
      toast.className = `toast toast-${type}`
      const icon = type === 'error' ? '‚ùå' : '‚úÖ'
      toast.innerHTML = `
        <span class="toast-icon">${icon}</span>
        <span>${message}</span>
      `
      document.body.appendChild(toast)

      setTimeout(() => {
        toast.style.animation = 'slideInRight 0.3s ease-out reverse'
        setTimeout(() => toast.remove(), 300)
      }, 3000)
    }

    async function fetchList() {
      const res = await fetch('/api/list')
      const data = await res.json()
      listEl.innerHTML = data.map(item => `
        <tr>
          <td data-label="Áü≠Á†Å"><a href="/${item.code}" target="_blank">${item.code}</a></td>
          <td data-label="ÁõÆÊ†áÂú∞ÂùÄ">${item.url}</td>
          <td data-label="Êìç‰Ωú">
            <button onclick="update('${item.code}', '${item.url.replace(/'/g, "\\'")}')">Êõ¥Êñ∞</button>
            <button onclick="remove('${item.code}')">Âà†Èô§</button>
          </td>
        </tr>
      `).join('')
    }

    function update(code, url) {
      document.getElementById('updateCode').value = code
      document.getElementById('updateUrl').value = url
      document.getElementById('updateCard').style.display = 'block'
      document.getElementById('updateCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    function cancelUpdate() {
      document.getElementById('updateCard').style.display = 'none'
      document.getElementById('updateForm').reset()
    }

    async function remove(code) {
      showConfirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Áü≠Á†Å <strong>"${code}"</strong> ÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ`, async () => {
        try {
          const res = await fetch('/api/delete', {
            method: 'POST',
            body: new URLSearchParams({ code })
          })
          if (res.ok) {
            showToast('Âà†Èô§ÊàêÂäü', 'success')
            fetchList()
          } else {
            const data = await res.json()
            showToast(data.error || 'Âà†Èô§Â§±Ë¥•')
          }
        } catch (error) {
          showToast('Âà†Èô§Â§±Ë¥•: ' + error.message)
        }
      })
    }

    document.getElementById('createForm').addEventListener('submit', async e => {
      e.preventDefault()
      try {
        const form = new FormData(e.target)
        const res = await fetch('/api/create', { method: 'POST', body: form })
        const data = await res.json()
        if (res.ok) {
          showToast('ÂàõÂª∫ÊàêÂäü', 'success')
          e.target.reset()
          fetchList()
        } else {
          showToast(data.error || 'ÂàõÂª∫Â§±Ë¥•')
        }
      } catch (error) {
        showToast('ÂàõÂª∫Â§±Ë¥•: ' + error.message)
      }
    })

    document.getElementById('updateForm').addEventListener('submit', async e => {
      e.preventDefault()
      try {
        const form = new FormData(e.target)
        const res = await fetch('/api/update', { method: 'POST', body: form })
        const data = await res.json()
        if (res.ok) {
          showToast('Êõ¥Êñ∞ÊàêÂäü', 'success')
          cancelUpdate()
          fetchList()
        } else {
          showToast(data.error || 'Êõ¥Êñ∞Â§±Ë¥•')
        }
      } catch (error) {
        showToast('Êõ¥Êñ∞Â§±Ë¥•: ' + error.message)
      }
    })

    fetchList()
  </script>
</body>
</html>
